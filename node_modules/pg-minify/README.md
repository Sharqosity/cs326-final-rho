pg-minify
=========

<<<<<<< HEAD
Minifies PostgreSQL scripts.

[![Build Status](https://travis-ci.org/vitaly-t/pg-minify.svg?branch=master)](https://travis-ci.org/vitaly-t/pg-minify)
[![Coverage Status](https://coveralls.io/repos/vitaly-t/pg-minify/badge.svg?branch=master)](https://coveralls.io/r/vitaly-t/pg-minify?branch=master)
[![Downloads Count](http://img.shields.io/npm/dm/pg-minify.svg)](https://www.npmjs.com/package/pg-minify)
[![Join the chat at https://gitter.im/vitaly-t/pg-minify](https://badges.gitter.im/vitaly-t/pg-minify.svg)](https://gitter.im/vitaly-t/pg-minify?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)

**Features:** 

* Removes both `/*multi-line*/` and `--single-line` comments
* Concatenates multi-line strings into a single line with `\n`
* Fixes multi-line text, prefixing it with `E` where needed
* Removes redundant line gaps: line breaks, tabs and spaces
* Provides basic parsing and error reporting for invalid SQL
* Flattens the resulting script into a single line
* Optionally, compresses SQL for minimum space 

This library is originally for PostgreSQL, though it works for MS-SQL and MySQL also.

**Limitations:**

* Multi-line quoted identifiers are not supported, throwing an error when encountered.
* Nested multi-line comments are not supported - `/* /* nested */ */`.

=======
Minifies PostgreSQL scripts, reducing the IO usage.

[![Build Status](https://travis-ci.org/vitaly-t/pg-minify.svg?branch=master)](https://travis-ci.org/vitaly-t/pg-minify)
[![Coverage Status](https://coveralls.io/repos/vitaly-t/pg-minify/badge.svg?branch=master)](https://coveralls.io/r/vitaly-t/pg-minify?branch=master)
[![Join the chat at https://gitter.im/vitaly-t/pg-minify](https://badges.gitter.im/vitaly-t/pg-minify.svg)](https://gitter.im/vitaly-t/pg-minify?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)

**Features:**

* Removes `/*multi-line*/` (including nested) and `--single-line` comments
* Preserves special/copyright multi-line comments that start with `/*!`
* Concatenates multi-line strings into a single line with `\n`
* Fixes multi-line text, prefixing it with `E` where needed
* Removes redundant line gaps: line breaks, tabs and spaces
* Provides basic parsing and error detection for invalid SQL
* Flattens the resulting script into a single line
* Optionally, compresses SQL for minimum space 

>>>>>>> 104b65a6409f9d6ba105288e6952992f9f09ce79
## Installing

```
$ npm install pg-minify
```

## Usage

```js
<<<<<<< HEAD
var minify = require('pg-minify');

var sql = "SELECT 1; -- comments";
=======
const minify = require('pg-minify');

const sql = 'SELECT 1; -- comments';
>>>>>>> 104b65a6409f9d6ba105288e6952992f9f09ce79

minify(sql); //=> SELECT 1;
```

with compression (removes all unnecessary spaces):

```js
<<<<<<< HEAD
var sql = 'SELECT * FROM "table" WHERE col = 123; -- comments';
=======
const sql = 'SELECT * FROM "table" WHERE col = 123; -- comments';
>>>>>>> 104b65a6409f9d6ba105288e6952992f9f09ce79

minify(sql, {compress: true});
//=> SELECT*FROM"table"WHERE col=123;
```

The library's distribution includes [TypeScript] declarations.

## Error Handling

[SQLParsingError] is thrown on failed SQL parsing:

```js
try {
<<<<<<< HEAD
    minify("SELECT '1");
=======
    minify('SELECT \'1');
>>>>>>> 104b65a6409f9d6ba105288e6952992f9f09ce79
} catch (error) {
    // error is minify.SQLParsingError instance
    // error.message:
    // Error parsing SQL at {line:1,col:8}: Unclosed text block.
}
```

## API

### minify(sql, [options]) ⇒ String

Minifies SQL into a single line, according to the `options`.

##### options.compress ⇒ Boolean

Compresses / uglifies the SQL to its bare minimum, by removing all unnecessary spaces.

<<<<<<< HEAD
* `false (default)` - keep minimum spaces, for easier read
* `true` - remove all unnecessary spaces 
=======
* `false (default)` - keeps minimum spaces, for easier read
* `true` - removes all unnecessary spaces 

See also: [SQL Compression].

##### options.removeAll ⇒ Boolean

Removes everything, i.e. special/copyright multi-line comments that start with `/*!` will be removed as well.
>>>>>>> 104b65a6409f9d6ba105288e6952992f9f09ce79

## Testing

First, clone the repository and install DEV dependencies.

```
$ npm test
```

Testing with coverage:
```
$ npm run coverage
```

## License

<<<<<<< HEAD
Copyright © 2017 [Vitaly Tomilov](https://github.com/vitaly-t);
Released under the MIT license.

[SQLParsingError]:https://github.com/vitaly-t/pg-minify/blob/master/lib/error.js#L21
[TypeScript]:https://github.com/vitaly-t/pg-minify/tree/master/typescript
=======
Copyright © 2020 [Vitaly Tomilov](https://github.com/vitaly-t);
Released under the MIT license.

[SQLParsingError]:https://github.com/vitaly-t/pg-minify/blob/master/lib/error.js#L22
[TypeScript]:https://github.com/vitaly-t/pg-minify/tree/master/typescript
[SQL Compression]:https://github.com/vitaly-t/pg-minify/wiki/SQL-Compression
>>>>>>> 104b65a6409f9d6ba105288e6952992f9f09ce79
